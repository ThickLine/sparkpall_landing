---
import Layout from "../../../layouts/Layout.astro";

const errorMessage =
  Astro.url.searchParams.get("error") ||
  "An unknown error occurred during authorization.";
---

<Layout
  title="Authorization Failed - SparkPall"
  description="There was an issue authorizing your SparkPall account"
>
  <div class="auth-container oauth-failure-container">
    <img src="/images/app-icon.svg" alt="SparkPall Logo" class="app-icon" />
    <h1>Authorization Failed</h1>
    <p class="message error">
      {errorMessage}
    </p>
    <div class="action-buttons">
      <button id="retryAuthBtn" class="btn primary">
        Retry Authorization
      </button>
      <button id="contactSupportBtn" class="btn secondary">
        Contact Support
      </button>
    </div>
    <div id="appStoreLinks">
      <p>Don't have the app installed? Download it now:</p>
      <div class="app-store-buttons">
        <a
          href="https://apps.apple.com/us/app/sparkpall/id1610931185"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img
            src="/images/app-store-badge.svg"
            alt="Download on the App Store"
            class="app-store-badge"
          />
        </a>
        <a
          href="https://play.google.com/store/apps/details?id=xyz.sparkpall.app"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img
            src="/images/google-play-badge.png"
            alt="Get it on Google Play"
            class="google-play-badge"
          />
        </a>
      </div>
    </div>
  </div>
</Layout>

<script>
  const appScheme = "sparkpall://";
  const supportEmail = "support@sparkpall.com";

  function retryAuth() {
    // Redirect to the beginning of the auth flow
    window.location.href = "/auth/oauth2/start";
  }

  function contactSupport() {
    window.location.href = `mailto:${supportEmail}?subject=Authorization%20Failure&body=I%20encountered%20an%20error%20during%20the%20authorization%20process.%20Please%20assist.`;
  }

  document.getElementById("retryAuthBtn").addEventListener("click", retryAuth);
  document
    .getElementById("contactSupportBtn")
    .addEventListener("click", contactSupport);
</script>

<style>
  .auth-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
    text-align: center;
  }

  .app-icon {
    width: 80px;
    height: 80px;
    margin-bottom: 1rem;
  }

  .message.error {
    color: #d32f2f;
    background-color: #ffcdd2;
    padding: 1rem;
    border-radius: 5px;
    margin-bottom: 1rem;
  }

  .action-buttons {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .primary {
    background-color: #007aff;
    color: white;
  }

  .primary:hover {
    background-color: #0056b3;
  }

  .secondary {
    background-color: #f0f0f0;
    color: #333;
  }

  .secondary:hover {
    background-color: #e0e0e0;
  }

  .app-store-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
  }

  .app-store-badge,
  .google-play-badge {
    height: 40px;
  }
</style>
